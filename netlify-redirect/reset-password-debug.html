<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Restablecer Contrase√±a</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .button {
            background: #1565C0;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            display: inline-block;
            margin: 5px;
        }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
    </style>
</head>
<body>
    <h1>üîê Debug - Restablecer Contrase√±a</h1>
    
    <div id="debug-info" class="debug-info">
        <h3>Informaci√≥n de Debug:</h3>
        <div id="url-info"></div>
    </div>
    
    <div id="status">
        <p>Analizando enlace...</p>
    </div>
    
    <div id="actions" style="margin-top: 20px;">
        <a href="statsfoot://reset-password" class="button">üîó Intentar abrir app (sin tokens)</a>
        <a href="https://statsfootpro.netlify.app/app/#/password_reset" class="button">üåê Ir a versi√≥n web</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar informaci√≥n de debug
            const debugInfo = document.getElementById('url-info');
            debugInfo.innerHTML = `
                <p><strong>URL completa:</strong> ${window.location.href}</p>
                <p><strong>Search params:</strong> ${window.location.search}</p>
                <p><strong>Hash:</strong> ${window.location.hash}</p>
                <p><strong>Pathname:</strong> ${window.location.pathname}</p>
            `;
            
            // Obtener par√°metros de todas las fuentes posibles
            const urlParams = new URLSearchParams(window.location.search);
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            
            let accessToken = urlParams.get('access_token') || hashParams.get('access_token');
            let refreshToken = urlParams.get('refresh_token') || hashParams.get('refresh_token');
            let type = urlParams.get('type') || hashParams.get('type');
            
            // Mostrar tokens encontrados
            debugInfo.innerHTML += `
                <h4>Tokens encontrados:</h4>
                <p><strong>Access Token:</strong> ${accessToken ? 'S√ç (' + accessToken.substring(0, 20) + '...)' : 'NO'}</p>
                <p><strong>Refresh Token:</strong> ${refreshToken ? 'S√ç (' + refreshToken.substring(0, 20) + '...)' : 'NO'}</p>
                <p><strong>Type:</strong> ${type || 'NO'}</p>
            `;
            
            const statusDiv = document.getElementById('status');
            const actionsDiv = document.getElementById('actions');
            
            if (accessToken && type === 'recovery') {
                // Tenemos tokens v√°lidos
                statusDiv.innerHTML = `
                    <div class="success">
                        <h3>‚úÖ Tokens v√°lidos encontrados</h3>
                        <p>Intentando abrir la aplicaci√≥n...</p>
                    </div>
                `;
                
                const appUrl = `statsfoot://reset-password?access_token=${accessToken}&refresh_token=${refreshToken || ''}&type=${type}`;
                
                // Agregar bot√≥n con tokens
                actionsDiv.innerHTML += `
                    <a href="${appUrl}" class="button">üîó Abrir app con tokens</a>
                `;
                
                // Intentar abrir la app autom√°ticamente
                setTimeout(() => {
                    window.location.href = appUrl;
                }, 2000);
                
            } else {
                // No hay tokens o son inv√°lidos
                statusDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ö†Ô∏è Problema detectado</h3>
                        <p>No se encontraron tokens v√°lidos en el enlace.</p>
                        <p>Esto puede indicar que:</p>
                        <ul>
                            <li>El enlace ha expirado</li>
                            <li>Ya se us√≥ anteriormente</li>
                            <li>Hay un problema con la configuraci√≥n de Supabase</li>
                        </ul>
                    </div>
                `;
            }
            
            // Agregar evento para copiar debug info
            debugInfo.addEventListener('click', function() {
                const textToCopy = debugInfo.innerText;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Informaci√≥n de debug copiada al portapapeles');
                });
            });
        });
    </script>
</body>
</html>
